# 📌 클러스터링을 통한 포트폴리오 최적화

이 코드는 `yfinance`를 사용하여 S&P 500 주요 기업들의 주가 데이터를 수집하고, 전처리 후 CSV 파일로 저장하는 전체 프로세스를 포함하고 있다.

---

## 1️⃣ **라이브러리 임포트**
먼저 데이터 수집과 처리를 위해 필요한 라이브러리를 불러온다.
- `yfinance` : Yahoo Finance API를 통해 주가 데이터를 다운로드하는 라이브러리.
- `pandas` : 데이터를 처리하고 CSV로 저장하는 데 사용.
- `os` : 파일 저장 경로를 관리하기 위해 사용.

---

## 2️⃣ **S&P 500 기업 티커 리스트 정의**
S&P 500 기업 중 특정 개수(예: 100개)의 기업을 선정하여 주식 티커(symbol) 리스트를 생성한다. 
- 이 티커 리스트는 Yahoo Finance에서 데이터를 가져올 때 사용된다.
- 리스트는 하드코딩되거나, 특정 기준(예: 시가총액 상위 100개 기업)을 기반으로 자동 생성될 수도 있다.

---

## 3️⃣ **주가 데이터 다운로드**
Yahoo Finance API를 사용하여 주가 데이터를 다운로드하는 과정.
- `yfinance.download()` 함수를 사용하여 티커 리스트에 해당하는 데이터를 한 번에 가져온다.
- 기간은 **2020년 1월 1일 ~ 2020년 12월 31일**로 설정됨.
- 데이터는 `Adj Close`(조정 종가) 값만 선택하여 저장.

📌 **수집되는 데이터 항목**
- 날짜(`Date`)
- 조정 종가(`Adj Close`): 배당금, 주식 분할 등을 반영한 실제 주가.

---

## 4️⃣ **데이터 전처리**
다운로드한 데이터의 품질을 높이기 위해 전처리 과정을 거친다.

### ✅ 4-1. 인덱스 변환
- 기본적으로 `Date` 컬럼이 인덱스로 설정되므로, 이를 명확하게 변환하여 데이터프레임으로 활용.

### ✅ 4-2. 결측치 처리
- 일부 주식의 경우 특정 날짜에 데이터가 없을 수 있음.
- `dropna()` 함수를 사용하여 결측값이 포함된 행을 제거.

### ✅ 4-3. 데이터 정렬 및 확인
- 데이터를 날짜순으로 정렬하여 분석이 용이하도록 구성.
- 주가 데이터가 올바르게 다운로드되었는지 `head()` 또는 `info()`를 사용해 확인.

---

## 5️⃣ **데이터 저장 (CSV 파일)**
전처리된 데이터를 CSV 파일로 저장한다.
- `to_csv()` 함수를 사용하여 로컬 저장.
- 파일 이름은 예를 들어 `"sp500_prices_2020.csv"` 형태로 지정.
- 저장 경로를 지정하여, 기존 파일이 있을 경우 덮어쓸 수 있도록 처리.

---

## 6️⃣ **예외 처리 및 로깅**
데이터 다운로드 및 저장 과정에서 오류가 발생할 수 있으므로 예외 처리를 포함한다.
- **네트워크 오류 처리**: Yahoo Finance API는 가끔 응답이 느리거나 실패할 수 있으므로, `try-except` 블록을 활용.
- **누락된 주식 데이터 감지**: 특정 주식이 다운로드되지 않은 경우 로그를 남김.
- **파일 저장 오류 처리**: 파일이 정상적으로 저장되었는지 확인.

---

## 7️⃣ **활용 방안**
이 데이터를 활용하여 다양한 금융 데이터 분석이 가능하다.
### 📊 **가능한 분석 방법**
1. **시계열 분석**: 특정 주식의 가격 변동 분석.
2. **상관관계 분석**: 여러 주식 간의 가격 움직임 비교.
3. **포트폴리오 최적화**: 위험 대비 수익률이 높은 주식 조합 찾기.
4. **머신러닝 모델 학습**: 주가 예측 모델 개발.

---

# ✅ **정리**
이 코드의 전체 프로세스는 다음과 같다.

1️⃣ **라이브러리 임포트**  
2️⃣ **S&P 500 티커 리스트 정의**  
3️⃣ **주가 데이터 다운로드 (`yfinance.download`)**  
4️⃣ **데이터 전처리 (결측치 제거, 정렬 등)**  
5️⃣ **CSV 파일로 저장 (`to_csv`)**  
6️⃣ **예외 처리 및 로깅**  
7️⃣ **데이터 분석 및 모델링 활용**

이 과정을 통해 S&P 500 주요 기업의 주가 데이터를 효과적으로 다운로드하고 저장할 수 있다.
